#!/bin/sh

set -e

TARGETDIR=target
for API in Reactor Rx; do
    for APP in Client Server; do
        LC_API=`/bin/echo -n $API | tr '[A-Z]' '[a-z]'`
        LC_APP=`/bin/echo -n $APP | tr '[A-Z]' '[a-z]'`
        docker build -t $LC_API-$LC_APP -f - "$TARGETDIR" <<-EOF
            FROM openjdk:8-jre-slim
            WORKDIR /app
            ENTRYPOINT ["java", "-cp", "grpc-load-balancing-demo.jar", "ping.$API$APP"]
            COPY grpc-load-balancing-demo-*.jar ./grpc-load-balancing-demo.jar
EOF
    done
done
